# 【MVP 需求说明书】—「古籍竖排繁‧简对照生成工具」  
版本：v1.0 撰写日期：YYYY-MM-DD  

## 1. 项目目标  
在 30 天内交付一款桌面命令行工具，实现以下闭环：  
输入「扫描版竖排古籍单页图像（TIFF/PNG，300 DPI）」  
→ 自动输出「竖排繁体列 + 左侧简体列」的单页 PNG 与可全文检索的 PDF。  

## 2. 术语与缩写  
- OCR：Optical Character Recognition，光学字符识别。  
- 列：竖排文本的一个垂直条带。  
- 繁列：OCR 后保持繁体的列图或文本。  
- 简列：繁列转简体后的文本渲染列。  

## 3. 用户角色  
- 录校员：批量生成初稿并手工校订 OCR 结果。  
- 研究者：直接浏览并引用繁简对照版。  

## 4. 典型流程  
1) 录校员将原图放入指定输入文件夹。  
2) 命令：`boocr run --input ./raw --output ./out`  
3) 系统完成处理，在输出文件夹生成：  
   a. `page_001_dual.png`（双列图）  
   b. `book.pdf`（整书合并，可搜索）  
   c. `meta.json`（OCR 文本、坐标、置信度）  

## 5. 功能范围（MVP 必做）  
### F1. 图像预处理  
- 自动二值化、倾斜校正；输入尺寸限制：A3 以内。  
### F2. 列检测与裁切  
- 检测 2–10 列；误差 ≤ ±1 字宽。  
### F3. 竖排 OCR（繁体输出）  
- 整页平均识别准确率 ≥ 90%。  
### F4. 繁→简体转换  
- 使用 OpenCC；保持字符数一致。  
### F5. 双列排版  
- 规则：右繁左简，列间距固定 20 px；字体可配置。  
### F6. 导出  
- 单页 PNG；批量合成为可搜索 PDF（嵌入简体文本层）。  
### F7. CLI 控制台  
- 必要命令：`run`、`resume`（断点续跑）、`version`。  
### F8. 日志与错误提示  
- 终端彩色日志；失败页编号写入 `failed.txt`。  

## 6. 边界 & 排除项  
- 不识别批注、插图、表格。  
- 不提供 GUI；仅命令行。  
- 不支持文言 → 白话翻译。  

## 7. 输入 / 输出规格  
### 输入：  
- 文件格式：TIFF/PNG；分辨率 300–600 DPI；色彩模式灰度 / RGB。  
### 输出：  
- 图片：PNG，分辨率与输入相同。  
- PDF：A4 自动分页；嵌入文字编码 UTF-8。  
- 元数据：`meta.json`，结构：  
```json
{
  "page": 1,
  "columns": [
    {"index": 0, "text_tra": "天地玄黃…", "text_simp": "天地玄黄…", "bbox": [x0, y0, x1, y1], "conf": 0.92},
    …
  ]
}
```

## 8. 性能与非功能需求  
- 处理速度：GTX 1060 GPU 环境下，单页 ≤ 5 s。  
- 资源占用：内存峰值 ≤ 2 GB。  
- 可移植性：Windows 10、Ubuntu 20.04。  
- 可恢复性：崩溃后再次 `run` 自动跳过已完成页。  

## 9. 质量衡量（验收标准）  
- A. 功能通过率：上述 F1–F8 全部演示成功。  
- B. OCR 准确率：随机抽样 50 页人工标注，正确字符率 ≥ 90%。  
- C. PDF 可检索测试：Acrobat 搜索任意简体词，跳转正确页。  
- D. 失败重跑：删除 3 页输出后 `resume`，仅重算缺失页。  

## 10. 里程碑  
- M1（第 1 周）：图像预处理 + 列切分原型。  
- M2（第 2 周）：OCR + 繁简转换连通，日志初版。  
- M3（第 3 周）：排版输出、PDF 合并、断点续跑。  
- M4（第 4 周）：测试、性能优化、文档发布。  

## 11. 风险与缓解  
- OCR 罕见字误识 → 预留二次训练接口，配置自定义字典。  
- 页边批注干扰列检测 → 提供 `--margin-cut N` 参数手工截断。 