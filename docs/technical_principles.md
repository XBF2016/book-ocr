# 古籍竖排繁‧简对照生成工具 - 技术原理

项目的技术原理可以分为六个关键步骤（对应 PRD 中的 P1–P6），它们按顺序串联形成一条最小可运行链路：

## 1. 图像预处理（P1）
- 使用 OpenCV 先将输入的 300 DPI 古籍竖排图像灰度化，然后通过 Otsu 自适应阈值法完成二值化，必要时可按 CLI 参数执行手动倾斜校正。这样做能提升后续列检测与 OCR 的可靠性。

## 2. 列检测与裁切（P2）
- 对二值化后的图像进行垂直投影统计，找到像素密度的低谷作为列分割线，可自动适配 2–6 列。误差控制在 ±2 个字宽范围内。
- 根据分割线把整页图片裁剪成若干列（ndarray），同时记录每列的边界框信息。

## 3. 竖排 OCR – 繁体识别（P3）
- 采用 PaddleOCR 的 vertical 模式并加载繁体中文模型，对每一列图像进行文字识别，输出繁体文本。目标正确率 ≥ 80%（示范页）。
- 若 PaddleOCR 不稳定，可预留 Tesseract 备选方案。

## 4. 繁体→简体转换（P4）
- 借助 opencc-py 调用「t2s.json」配置文件，将 OCR 得到的繁体文本逐字转换为简体，并保证字符数与原文一致，便于后续排版对齐。

## 5. 双列排版渲染（P5）
- 使用 Pillow 在与原图同分辨率的空白画布上，从右到左逐行绘制繁体列，再在左侧绘制对应的简体列，列间固定间距 20 px，默认系统字体（如 SimSun）。
- 生成最终的 `page_dual.png`，右繁左简的对照排版便于校读。

## 6. CLI 验证命令（P6）
- 提供 `boocr poc --input <img> --output <dir>` 命令作为入口：
  - 依次调用上述五个模块的核心函数（见 pipeline.py）。
  - 运行结束后在输出目录写出 `page_dual.png` 并在终端打印 "DONE"，返回码 0。
- 整个流程同步串行，方便调试和定位问题。

## 数据流与结构

数据在模块之间通过标准 dataclass 传递：
PageImage → ColumnCrop → OcrResult → DualText → RenderConfig。这样既保持类型清晰，也降低模块耦合度。

整体而言，该工具利用成熟的图像处理与 OCR 组件，通过轻量级的 Python CLI 将"竖排古籍图像"快速转换为"繁简对照图片"，满足小规模校勘场景的最低可用需求。
