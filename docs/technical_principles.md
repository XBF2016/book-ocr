# 古籍竖排简体文字生成工具 - 技术原理

项目的技术原理可以分为七个关键步骤（对应 PRD 中的 P0–P6），它们按顺序串联形成一条最小可运行链路：

## 0. PDF 拆页与光栅化（P0）
- 当输入为 PDF 文件时，使用 `pdfplumber` 或 `PyPDF2` 将其指定页面提取并光栅化为 300 DPI 的高质量图像（ndarray），作为后续处理的统一输入格式。

## 1. 图像预处理（P1）
- 使用 OpenCV 先将输入的 300 DPI 古籍竖排图像灰度化，然后通过 Otsu 自适应阈值法完成二值化，必要时可按 CLI 参数执行手动倾斜校正。这样做能提升后续列检测与 OCR 的可靠性。

## 2. 列检测与裁切（P2）
- 对二值化后的图像进行垂直投影统计，找到像素密度的低谷作为列分割线，可自动适配 2–6 列。误差控制在 ±2 个字宽范围内。
- 根据分割线把整页图片裁剪成若干列（ndarray），同时记录每列的边界框信息。

## 3. 竖排 OCR – 繁体识别（P3）
- 采用 PaddleOCR 的 vertical 模式并加载繁体中文模型，对每一列图像进行文字识别，输出繁体文本。目标正确率 ≥ 80%（示范页）。
- 若 PaddleOCR 不稳定，可预留 Tesseract 备选方案。

## 4. 繁体→简体转换（P4）
- 借助 opencc-py 调用「t2s.json」配置文件，将 OCR 得到的繁体文本逐字转换为简体，并保证字符数与原文一致，便于后续排版对齐。

## 5. 竖排简体可搜索 PDF 生成（P5）
- 借助 `reportlab` 或 `fpdf2`，根据 OCR 结果的坐标信息，在对应位置直接绘制竖排的简体文字，确保文本可搜索且排版（列数、字数）与原书一致。
- 生成最终的 `page_simplified.pdf`。

## 6. CLI 验证命令（P6）
- 提供 `boocr poc --input <in.pdf> --output <page_simplified.pdf>` 命令作为入口：
  - 依次调用上述 P0–P5 模块的核心函数（见 pipeline.py）。
  - 运行结束后写出 `page_simplified.pdf` 并在终端打印 "DONE"，返回码 0。
- 整个流程同步串行，方便调试和定位问题。

## 数据流与结构

数据在模块之间通过标准 dataclass 传递：
InputSource → PageImage → ColumnCrop → OcrResult → RenderedPage。这样既保持类型清晰，也降低模块耦合度。

整体而言，该工具利用成熟的图像处理与 OCR 组件，通过轻量级的 Python CLI 将"竖排古籍扫描件"快速转换为"竖排简体文字的可搜索 PDF"，满足小规模校勘场景的最低可用需求。
